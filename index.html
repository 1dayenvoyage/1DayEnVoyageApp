tool_use_id=toolu_vrtx_016g5kcf132XxPDnEb2v2QuE
tool_name=replace_code
input={"old_str": "        // Initialize app\n        document.addEventListener('DOMContentLoaded', function() {\n            // Check if user is logged in\n            if (!currentUser) {\n                showLoginScreen();\n            } else {\n                renderTripSelector();\n                renderBookings();\n                renderItinerary();\n                renderContacts();\n                renderRecommendations();\n                updateNotificationBadge();\n                updateOverviewSection();\n            }\n        });", "new_str": "        // Admin Functions\n        function showAdminModal(title, content) {\n            document.getElementById('admin-modal-title').textContent = title;\n            document.getElementById('admin-modal-content').innerHTML = content;\n            document.getElementById('admin-modal').classList.remove('hidden');\n        }\n\n        function closeAdminModal() {\n            document.getElementById('admin-modal').classList.add('hidden');\n        }\n\n        function createNewTrip() {\n            const clientOptions = Object.values(users)\n                .filter(u => u.role === 'client')\n                .map(u => `<option value=\"${u.username}\">${u.displayName}</option>`)\n                .join('');\n\n            showAdminModal('Créer un Nouveau Voyage', `\n                <form onsubmit=\"saveNewTrip(event)\" class=\"space-y-6\">\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Nom du voyage</label>\n                            <input type=\"text\" name=\"name\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                        </div>\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Client</label>\n                            <select name=\"clientUsername\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                                <option value=\"\">Sélectionner un client</option>\n                                ${clientOptions}\n                            </select>\n                        </div>\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Destination</label>\n                        <input type=\"text\" name=\"destination\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Date de début</label>\n                            <input type=\"text\" name=\"startDate\" required placeholder=\"ex: 15 Juin 2024\" class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                        </div>\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Date de fin</label>\n                            <input type=\"text\" name=\"endDate\" required placeholder=\"ex: 22 Juin 2024\" class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                        </div>\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Description</label>\n                        <textarea name=\"description\" rows=\"3\" class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\"></textarea>\n                    </div>\n                    <div class=\"flex space-x-3\">\n                        <button type=\"button\" onclick=\"closeAdminModal()\" class=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\">Annuler</button>\n                        <button type=\"submit\" class=\"flex-1 px-4 py-2 bg-eco-green-500 hover:bg-eco-green-600 text-white rounded-lg\">Créer le Voyage</button>\n                    </div>\n                </form>\n            `);\n        }\n\n        function saveNewTrip(event) {\n            event.preventDefault();\n            const formData = new FormData(event.target);\n            const clientUsername = formData.get('clientUsername');\n            const client = users[clientUsername];\n            \n            const tripId = 'trip-' + Date.now();\n            const newTrip = {\n                id: tripId,\n                name: formData.get('name'),\n                destination: formData.get('destination'),\n                startDate: formData.get('startDate'),\n                endDate: formData.get('endDate'),\n                clientName: client.displayName,\n                description: formData.get('description') || 'Voyage personnalisé',\n                userId: clientUsername,\n                bookings: [],\n                itinerary: [],\n                contacts: [\n                    {\n                        id: 1,\n                        name: 'Travel Planner - Support',\n                        phone: '+33 1 42 56 78 90',\n                        email: 'support@travelplanner.fr',\n                        type: 'support',\n                        available: '24h/24'\n                    }\n                ],\n                recommendations: [],\n                notifications: []\n            };\n            \n            trips[tripId] = newTrip;\n            \n            // Add trip to user's trip list\n            if (!userTrips[clientUsername]) {\n                userTrips[clientUsername] = [];\n            }\n            userTrips[clientUsername].push(tripId);\n            \n            renderAdminTrips();\n            closeAdminModal();\n            showCustomAlert('Voyage créé avec succès !');\n        }\n\n        function createNewClient() {\n            showAdminModal('Ajouter un Nouveau Client', `\n                <form onsubmit=\"saveNewClient(event)\" class=\"space-y-6\">\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Nom d'affichage</label>\n                        <input type=\"text\" name=\"displayName\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Nom d'utilisateur</label>\n                        <input type=\"text\" name=\"username\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Email</label>\n                        <input type=\"email\" name=\"email\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Mot de passe</label>\n                        <input type=\"text\" name=\"password\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div class=\"flex space-x-3\">\n                        <button type=\"button\" onclick=\"closeAdminModal()\" class=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\">Annuler</button>\n                        <button type=\"submit\" class=\"flex-1 px-4 py-2 bg-warm-yellow-500 hover:bg-warm-yellow-600 text-white rounded-lg\">Créer le Client</button>\n                    </div>\n                </form>\n            `);\n        }\n\n        function saveNewClient(event) {\n            event.preventDefault();\n            const formData = new FormData(event.target);\n            const username = formData.get('username');\n            \n            if (users[username]) {\n                showCustomAlert('Ce nom d\\'utilisateur existe déjà !');\n                return;\n            }\n            \n            users[username] = {\n                username: username,\n                password: formData.get('password'),\n                displayName: formData.get('displayName'),\n                email: formData.get('email'),\n                role: 'client'\n            };\n            \n            userTrips[username] = [];\n            \n            renderAdminClients();\n            closeAdminModal();\n            showCustomAlert('Client créé avec succès !');\n        }\n\n        function exportAllData() {\n            const data = {\n                users: users,\n                trips: trips,\n                userTrips: userTrips,\n                exportDate: new Date().toISOString()\n            };\n            \n            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'travel-planner-data-' + new Date().toISOString().split('T')[0] + '.json';\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            URL.revokeObjectURL(url);\n            \n            showCustomAlert('Données exportées avec succès !');\n        }\n\n        function exportTripsCSV() {\n            const headers = ['ID', 'Nom', 'Client', 'Destination', 'Date Début', 'Date Fin', 'Réservations', 'Activités'];\n            const rows = Object.values(trips).map(trip => [\n                trip.id,\n                trip.name,\n                trip.clientName,\n                trip.destination,\n                trip.startDate,\n                trip.endDate,\n                trip.bookings.length,\n                trip.itinerary.length\n            ]);\n            \n            const csvContent = [headers, ...rows].map(row => row.join(',')).join('\\\\n');\n            const blob = new Blob([csvContent], { type: 'text/csv' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'voyages-' + new Date().toISOString().split('T')[0] + '.csv';\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            URL.revokeObjectURL(url);\n        }\n\n        function exportClientsCSV() {\n            const clients = Object.values(users).filter(u => u.role === 'client');\n            const headers = ['Username', 'Nom', 'Email', 'Nombre de Voyages'];\n            const rows = clients.map(client => [\n                client.username,\n                client.displayName,\n                client.email,\n                (userTrips[client.username] || []).length\n            ]);\n            \n            const csvContent = [headers, ...rows].map(row => row.join(',')).join('\\\\n');\n            const blob = new Blob([csvContent], { type: 'text/csv' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'clients-' + new Date().toISOString().split('T')[0] + '.csv';\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            URL.revokeObjectURL(url);\n        }\n\n        function importData() {\n            const fileInput = document.getElementById('import-file');\n            const file = fileInput.files[0];\n            \n            if (!file) {\n                showCustomAlert('Veuillez sélectionner un fichier JSON.');\n                return;\n            }\n            \n            const reader = new FileReader();\n            reader.onload = function(e) {\n                try {\n                    const data = JSON.parse(e.target.result);\n                    \n                    if (data.users) users = data.users;\n                    if (data.trips) trips = data.trips;\n                    if (data.userTrips) userTrips = data.userTrips;\n                    \n                    renderAdminTrips();\n                    renderAdminClients();\n                    showCustomAlert('Données importées avec succès !');\n                } catch (error) {\n                    showCustomAlert('Erreur lors de l\\'import: fichier JSON invalide.');\n                }\n            };\n            reader.readAsText(file);\n        }\n\n        function editTrip(tripId) {\n            const trip = trips[tripId];\n            showAdminModal('Modifier le Voyage', `\n                <form onsubmit=\"updateTrip(event, '${tripId}')\" class=\"space-y-6\">\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Nom du voyage</label>\n                        <input type=\"text\" name=\"name\" value=\"${trip.name}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Destination</label>\n                        <input type=\"text\" name=\"destination\" value=\"${trip.destination}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Date de début</label>\n                            <input type=\"text\" name=\"startDate\" value=\"${trip.startDate}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                        </div>\n                        <div>\n                            <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Date de fin</label>\n                            <input type=\"text\" name=\"endDate\" value=\"${trip.endDate}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                        </div>\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Description</label>\n                        <textarea name=\"description\" rows=\"3\" class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">${trip.description}</textarea>\n                    </div>\n                    <div class=\"flex space-x-3\">\n                        <button type=\"button\" onclick=\"closeAdminModal()\" class=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\">Annuler</button>\n                        <button type=\"submit\" class=\"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg\">Mettre à jour</button>\n                    </div>\n                </form>\n            `);\n        }\n\n        function updateTrip(event, tripId) {\n            event.preventDefault();\n            const formData = new FormData(event.target);\n            \n            trips[tripId].name = formData.get('name');\n            trips[tripId].destination = formData.get('destination');\n            trips[tripId].startDate = formData.get('startDate');\n            trips[tripId].endDate = formData.get('endDate');\n            trips[tripId].description = formData.get('description');\n            \n            renderAdminTrips();\n            closeAdminModal();\n            showCustomAlert('Voyage mis à jour avec succès !');\n        }\n\n        function deleteTrip(tripId) {\n            showConfirmModal('Supprimer le voyage', 'Êtes-vous sûr de vouloir supprimer ce voyage ? Cette action est irréversible.', () => {\n                // Remove from trips\n                delete trips[tripId];\n                \n                // Remove from userTrips\n                Object.keys(userTrips).forEach(username => {\n                    userTrips[username] = userTrips[username].filter(id => id !== tripId);\n                });\n                \n                renderAdminTrips();\n                showCustomAlert('Voyage supprimé avec succès !');\n            });\n        }\n\n        function editClient(username) {\n            const client = users[username];\n            showAdminModal('Modifier le Client', `\n                <form onsubmit=\"updateClient(event, '${username}')\" class=\"space-y-6\">\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Nom d'affichage</label>\n                        <input type=\"text\" name=\"displayName\" value=\"${client.displayName}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Email</label>\n                        <input type=\"email\" name=\"email\" value=\"${client.email}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div>\n                        <label class=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Mot de passe</label>\n                        <input type=\"text\" name=\"password\" value=\"${client.password}\" required class=\"w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-700 text-base\">\n                    </div>\n                    <div class=\"flex space-x-3\">\n                        <button type=\"button\" onclick=\"closeAdminModal()\" class=\"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700\">Annuler</button>\n                        <button type=\"submit\" class=\"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg\">Mettre à jour</button>\n                    </div>\n                </form>\n            `);\n        }\n\n        function updateClient(event, username) {\n            event.preventDefault();\n            const formData = new FormData(event.target);\n            \n            users[username].displayName = formData.get('displayName');\n            users[username].email = formData.get('email');\n            users[username].password = formData.get('password');\n            \n            renderAdminClients();\n            closeAdminModal();\n            showCustomAlert('Client mis à jour avec succès !');\n        }\n\n        function deleteClient(username) {\n            showConfirmModal('Supprimer le client', 'Êtes-vous sûr de vouloir supprimer ce client ? Tous ses voyages seront également supprimés.', () => {\n                // Remove client's trips\n                const clientTrips = userTrips[username] || [];\n                clientTrips.forEach(tripId => {\n                    delete trips[tripId];\n                });\n                \n                // Remove client\n                delete users[username];\n                delete userTrips[username];\n                \n                renderAdminClients();\n                renderAdminTrips();\n                showCustomAlert('Client supprimé avec succès !');\n            });\n        }\n\n        function showConfirmModal(title, message, onConfirm) {\n            const modal = document.createElement('div');\n            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n            modal.innerHTML = `\n                <div class=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4\">\n                    <h3 class=\"text-lg font-semibold text-gray-900 dark:text-white mb-2\">${title}</h3>\n                    <p class=\"text-gray-700 dark:text-gray-300 mb-4\">${message}</p>\n                    <div class=\"flex justify-end space-x-3\">\n                        <button onclick=\"this.closest('.fixed').remove()\" class=\"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded\">Annuler</button>\n                        <button onclick=\"this.closest('.fixed').remove(); (${onConfirm})()\" class=\"px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded\">Confirmer</button>\n                    </div>\n                </div>\n            `;\n            document.body.appendChild(modal);\n        }\n\n        // Initialize app\n        document.addEventListener('DOMContentLoaded', function() {\n            // Check if user is logged in\n            if (!currentUser) {\n                showLoginScreen();\n            } else {\n                renderTripSelector();\n                renderBookings();\n                renderItinerary();\n                renderContacts();\n                renderRecommendations();\n                updateNotificationBadge();\n                updateOverviewSection();\n            }\n        });"}
